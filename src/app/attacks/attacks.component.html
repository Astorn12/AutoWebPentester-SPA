<div class="d-flex flex-column">
  <div class="d-flex flex-row bd-highlight">
    <label>Attacked page: </label>
    <input class="" matInput placeholder="Pentested website" value="{{websiteToPentest}}">
  </div>
  <div class="d-flex flex-row">
    <div clas="d-flex flex-column ">
      <div style="background-color: #AAAAAA;" class="mt-4 p-2 ">
        <mat-radio-group #radioGroup [(ngModel)]="favoriteSeason">
          <mat-radio-button [value]="i" [checked]="i === 0" (change)="radioChange(sort)"  class="mx-2"
            *ngFor="let sort of pentestSortKinds; let i=index ">{{sort.name}}</mat-radio-button>
        </mat-radio-group>

      </div>

      <app-tagtree [data]="choosenTag.tags" [websiteId]="website?.id" (pentestHasBeenChoosenEmitter)=setChoosenPentest($event)></app-tagtree>


    </div>
    <div class="d-flex w-100 justify-content-center align-items-center "  *ngIf="!choosenPentest" > 
      <p style="font-size : 40px; font-family: hacker">Choose pentest</p>
    </div>
    <div *ngIf="choosenPentest" class="d-flex flex-column">
      <mat-label class="align-self-center ">{{choosenPentest?.name}}</mat-label>
      <!--  <button mat-raised-button (click)="isLinear = !isLinear" id="toggle-linear">
            {{!isLinear ? 'Enable linear mode' : 'Disable linear mode'}}
          </button>-->
      <mat-horizontal-stepper  (selectionChange)="stepClick($event)" class="w-100" [linear]="true" #stepper>
        <mat-step  [completed]="requirementCompleteness" >
          

          <ng-template matStepLabel>Requirements</ng-template>
         
          <mat-list>
            <mat-list-item *ngFor="let resource of choosenPentest?.resources">

               {{resource.name}} 
               <mat-icon style="color: forestgreen" *ngIf="resource.isFound">done</mat-icon>
               <button (click)="loadPentestsProvidedResource(resource)" mat-icon-button  [matMenuTriggerFor]="menu" *ngIf="!resource.isFound"> <mat-icon>arrow_right_alt</mat-icon> </button>
               <mat-menu #menu="matMenu">
                
                <div *ngIf="pentestToProvideResources==null">
                  <mat-spinner></mat-spinner>
                </div>

                <div *ngIf="pentestToProvideResources!=null">
                <div  class="d-flex flex-row" *ngFor="let pentest of pentestToProvideResources">
                  <label mat-menu-item>{{pentest.name}}</label>
                  <button mat-icon-button (click)="openNewPentest(pentest)" >  <mat-icon style="color: green">play_arrow</mat-icon>   </button>
                </div>
              </div>
               
                
              </mat-menu>
              </mat-list-item>

          </mat-list>

          <div>
            <button (click)="realoadRequiredResources()" [ngClass]="{'rotate' : requiredResourdesLoading}" mat-icon-button> <mat-icon> replay </mat-icon></button>
            <button #b1 [disabled]="!areRequirementsFulfilled(choosenPentest?.resources)"  [ngStyle]="{'color': b1.disabled ? 'red':'green'}" mat-button (click)="next()" >Next</button>

          </div>
       
        </mat-step>
        
        <mat-step [completed]="inputCompleteness"   *ngIf="choosenPentest!=null && choosenPentest.inputs!=null" >

          <ng-template   matStepLabel>Input</ng-template>

          <mat-tab-group>
            <mat-tab label="{{input.Name}}" *ngFor="let input of choosenPentest?.inputs">  
              <app-jsonForm [input]="input" (nextEmiter)="startPentest($event)"> </app-jsonForm>
            </mat-tab>
           
          </mat-tab-group>

          

        </mat-step>
        <mat-step [completed]="resultCompleteness" >
          <ng-template matStepLabel>Result</ng-template>
          <div class="d-flex justify-content-center align-item-center">
            <div *ngIf="waitingForPentestOutput">
              <mat-spinner></mat-spinner>
            </div>
            <div *ngIf="!waitingForPentestOutput">
                <pre>
                  
                  {{choosenPentestOutcome?.outcome|json}}
                  
                </pre>
            </div>
          </div>
        </mat-step>
       
        
      </mat-horizontal-stepper>
     
      
    </div>

  </div>
</div>